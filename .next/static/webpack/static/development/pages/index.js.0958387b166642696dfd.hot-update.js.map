{"version":3,"file":"static/webpack/static/development/pages/index.js.0958387b166642696dfd.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import { useEffect } from 'react';\nimport { Button, Icon, Tabs } from 'antd';\nimport getConfig from 'next/config';\nimport { connect } from 'react-redux';\nimport Router, { withRouter } from 'next/router';\nimport Repo from '../components/Repos';\nimport LRU from 'lru-cache';\n\n//#1 way to cache: lru-cache\nconst cache = new LRU({\n    maxAge: 1000 * 10,\n});\n\nconst { publicRuntimeConfig } = getConfig();\n\nconst api = require('../lib/api');\n\nconst url = '/search/repositories?q=react';\n\nconst isServer = typeof window === 'undefined';\n\n//#2 way to cache\nlet cachedUserRepos, cachedStarredRepos;\n\nfunction Index ({ userRepos, starredRepos, user, router }) {\n    const tabKey = router.query.key || '1';\n\n    const handleTableChange = activeKey => {\n        Router.push(`/?key=${activeKey}`);\n    }\n\n    useEffect(() => {\n        if (!isServer) {\n            // cachedUserRepos = userRepos;\n            // cachedStarredRepos = starredRepos;\n            if (userRepos) {\n                cache.set('userRepos', userRepos);\n            }\n            if (starredRepos) {\n                cache.set('starredRepos', starredRepos);\n            } \n        }\n    }, [userRepos, starredRepos]);\n\n    if (!user || !user.id) {\n        return (\n            <div className=\"root\">\n                <p>Please Log In with Your Github Account</p>\n                <Button \n                    type='primary' \n                    href={ publicRuntimeConfig.OAUTH_URL }\n                >   \n                    Click to Log In\n                </Button>\n                <style jsx>{`\n                    .root {\n                        height: 400px;\n                        display: flex;\n                        flex-direction: column;\n                        justify-content: center;\n                        align-items: center; \n                    }\n                `}</style>\n            </div>\n        )\n    }\n    return (\n        <div className=\"root\">\n            <div className=\"user-info\">\n                <img \n                    src={user.avatar_url} \n                    alt=\"use avatar\" \n                    className=\"avatar\"\n                />\n                <span className=\"login\">{user.login}</span>\n                <span className=\"name\">{user.name}</span>\n                <span className=\"bio\">{user.bio}</span>\n                <p className=\"email\">\n                    <Icon \n                        type='mail'\n                        style={{ marginRight: 5 }}\n                    />\n                    <a href={`mailto:${user.email}`}>{user.email}</a>\n                </p>\n            </div>\n            <div className=\"user-repos\">\n                <Tabs \n                    activeKey={tabKey} \n                    animated={false}\n                    onChange={handleTableChange}\n                >\n                    <Tabs.TabPane tab=\"Your Repositories\" key=\"1\">\n                        {userRepos.map((repo,key) => \n                            <Repo key={key} repo={repo}/>\n                        )}\n                    </Tabs.TabPane>\n                    <Tabs.TabPane tab=\"Starred Repositories\" key=\"2\">\n                        {starredRepos.map((repo,key) => \n                            <Repo key={key} repo={repo}/>\n                        )}\n                    </Tabs.TabPane>\n                </Tabs>          \n            </div>\n            <style jsx>{`\n                .root {\n                    display: flex;\n                    align-items: flex-start;\n                    \n                }\n                .user-info {\n                    width: 200px;\n                    margin-right: 40px;\n                    flex-shrink: 0;\n                    display: flex;\n                    flex-direction: column\n                }\n                .login {\n                    font-weight: 800;\n                    font-size: 20px;\n                    margin-top: 20px;\n                }.\n                .name {\n                    font-size: 16px;\n                    color: #777;\n                }\n                .bio {\n                    margin-top: 20px;\n                    color: #333;\n                }\n                .avatar {\n                    width: 100%;\n                    border-radius: 5px;\n                }\n                .user-repos {\n                    flex-grow: 1;\n                }\n            `}</style>\n        </div>\n    )\n} \n\n/*getInitialProps 会在客户端不同页面之间每次跳转时调用\n同时在服务端渲染的时候，若访问index页面，getInitialProps也会被调用\n属于node环境，不存在客户端domain这些window下才有的环境\n*/\n\nIndex.getInitialProps = async ({ ctx, reduxStore }) => {\n    const user = reduxStore.getState().user;\n    if (!user || !user.id) {\n        return {};\n    }\n\n    if (!isServer) {\n        // if (cache.get('userRepos') && cache.get('starredRepos')) {\n        //     return {\n        //         userRepos: cache.get('userRepos'),\n        //         starredRepos: cache.get('starredRepos')\n        //     }\n        // }\n        if (cachedUserRepos && cachedStarredRepos) {\n            return {\n                userRepos: cachedUserRepos,\n                starredRepos: cachedStarredRepos,\n            }\n        } \n    }\n    \n    const userRepos = await api.request({ url: '/user/repos' }, ctx.req, ctx.res);\n    const userStarredRepos = await api.request(\n        { url: `/user/starred` },\n        ctx.req,\n        ctx.res\n    );\n    \n    \n    \n    return {\n        userRepos: userRepos.data,\n        starredRepos: userStarredRepos.data\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        user: state.user, \n    }\n}\n\n//withRouter() wrap all connect()\nexport default withRouter(connect(mapStateToProps)(Index))  ;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AADA;AACA;AAGA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAFA;AAFA;AAAA;AAmBA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAFA;AAAA;AAKA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAGA;AAAA;AAEA;AACA;AACA;AAHA;AAKA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AADA;AAIA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AADA;AA9BA;AAAA;AAwEA;AAEA;;;;;;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAeA;AACA;AAFA;AACA;AAfA;AAAA;AAAA;AAqBA;AAAA;AACA;AAtBA;AAqBA;AArBA;AAAA;AAuBA;AAAA;AACA;AAxBA;AAsBA;AAtBA;AA+BA;AACA;AAFA;AACA;AA/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAmCA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;;;;A","sourceRoot":""}